<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Witness Visualizer</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --card-bg: #141414;
            --border: #2a2a2a;
            --text: #e0e0e0;
            --text-dim: #888;
            --accent: #4a9eff;
            --success: #4ade80;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        h1 span { color: var(--accent); }
        .subtitle {
            color: var(--text-dim);
            font-size: 0.875rem;
            margin-bottom: 2rem;
        }
        .status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            font-size: 0.875rem;
        }
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-dim);
        }
        .dot.connected { background: var(--success); }
        .dot.connecting { background: #fbbf24; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .events {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .event {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .event-type {
            color: var(--accent);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        .event-time {
            color: var(--text-dim);
            font-size: 0.75rem;
        }
        .event-hash {
            font-size: 0.875rem;
            word-break: break-all;
            color: var(--success);
        }
        .empty {
            color: var(--text-dim);
            text-align: center;
            padding: 2rem;
        }
        .counter {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <h1><span>Witness</span> Visualizer</h1>
    <p class="subtitle">Real-time attestation events</p>

    <div class="status">
        <span class="dot" id="status-dot"></span>
        <span id="status-text">Connecting...</span>
    </div>

    <div class="counter" id="counter">0</div>

    <div class="events" id="events">
        <div class="empty">Waiting for attestations...</div>
    </div>

    <audio id="chime" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp6WgXBjYXKBjpqfmIx+cGZqd4WSmp2WjH5wZmp3hZKanZaMfnBmaneFlJqdlox+cGZqd4WUmp2Wi35wZWl2hZSanZaLfnBlaXaFlJqdm4t+cGVpdoWUmpybi35wZWl2hZOam5qLfnBlaXaFk5qbmot+cGVpdoWTmpuai35wZWl2hZOam5qLfnBlaXaFk5qbmop+cGVpdoWTmpuain5wZWl2hZOam5qKfnBlaXaFk5qbmop9cGRodYWTmpuZin1wZGh1hZKZm5mKfXBkaHWFkpmamYl9cGRodIWSmZqZiX1wZGh0hZKZmpmJfXBkaHSFkpmamYl9cGRodIWSmZmYiH1vY2d0hJKZmZiIfW9jZ3SEkpiZmId9b2NndISSmJmYh31vY2d0hJKYmZiHfW9jZ3SEkpiZmId9b2NndISSmJiXh31vY2d0hJKYmJeHfW9jZ3SElJiYl4d9b2NndISSmJiXh31vY2Z0hJKYmJeHfG5iZnOEkpiYl4d8bmJmc4SSmJeWhnxuYmZzhJKYl5aGfG5iZnOEkpiXloZ8bmJmc4OSmJeWhnxuYmZzg5KYl5aGfG5iZnODkpiXloV8bmJmc4OSmJeVhXxuYWVyg5KXlpWFfG5hZXKDkpeWlYV8bmFlcoOSl5aVhXxuYWVyg5GXlpWFfG5hZXKDkZeWlYV8bmFlcoORl5WUhHxuYGRxg5GXlZSEfG5gZHGDkZeVlIR8bWBkcYORlpWUhHttYGRxg5GWlZSEe21gZHGDkZaVlIN7bV9jcIOQlpSUg3ttX2Nwg5CWlJSDe21fY3CDkJaUk4N7bV9jcIOQlpSTg3ttX2Nwg5CVlJODe21fY3CDkJWUk4N7bV9jcIOQlZSTg3tsXmJvgo+Vk5KCe2xeYm+Cj5WTkoJ7bF5ib4KPlZOSgntsXmJvgo+VkpKCe2xeYm+Cj5WSkYJ7a11hboKPlZKRgXtrXWFugo+UkpGBe2tdYW6Cj5SRkYF7al1hboKPlJGRgXtqXWBtgo6UkZGAe2pdYG2CjpSRkIB6aVxgbYKOk5GQgHppXGBtgo6TkZCAemlcYG2CjpORkIB6aVxgbYKOk5GQgHppXGBtgo6TkI+AemhbX2yCjpOQj4B6aFtfbIKNk5CPf3poW19sgo2SkI9/emhbX2yCjZKQj396aFtfbIKNkpCPf3poW19sgo2SkI9/emhbX2yCjZKQj396aFtfbIKNkpCPf3poW19sgo2SkI9/emhbX2yCjZKQj396aFtfbIKNkpCPfnlnWl5rgY2SkI9+eWdaXmuBjZKQjn55Z1pea4GNko+OfnlnWl5rgY2Sj45+eWdaXmuBjZKPjn55Z1peaoGMko+OfnhnWV5qgYySj419eGdZXmqBjJGPjX14Z1lean+MkY+NfXhnWV5qf4yRj418eGdZXmp/jJGOjXx4ZlhcaX+MkY6NfHhmWFxpf4yQjo18eGZYXGl/jJCOjHx4ZlhcaX+MkI6MfHhmWFxpf4yQjYx8eGZYXGl/jJCNjHx4ZlhcaX+MkI2MfHhmWFxpf4yQjYx8eGZYXGl/jJCNi3x3ZVdbaH6LkI2Le3dlV1tofouPjYt7d2VXW2h+i4+Ni3t3ZVdbaH6Lj42Le3dlV1tofouPjYt7d2VXW2h+i4+Mi3t3ZVdbaH6Lj4yLe3dlV1tofouPjIt7d2VXW2h+i4+Mi3t3ZVdbaH6Lj4yLe3dlV1tnfouPjIt7d2RWVmd9io6LindnZVZWZn2KjYt6d2ZlVlZmfYqMi3p3ZmVWVmZ9ioyKendlVFVlfIqMint3ZVRVZX2Ki4p6d2VUVmV8ioqKendlVFZlfIqKinp3ZVRVZX2Kiop6d2VUVmV8ioqKendkU1RkfImKiXl2ZFRUZHyJiYl5dmRUVGR8iYmJeXZkVFRkfImJiXl2ZFRUZHyJiYl5dmRUVGR8iYmIeXZkVFRjfImJiHl2ZFRTYnyIiYh4dWNTU2J8iIiId3VjU1NifIiIiHd1Y1NTYnyIiIh3dWNTU2J8iIiId3VjU1NifIiIiHd1Y1NTYnyIiIh3dWNTU2J8iIeHd3VjU1NifIiHh3d1Y1NTYnyIh4d3dWNTU2J8iIeHd3U=" type="audio/wav">
    </audio>

    <script>
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');
        const eventsContainer = document.getElementById('events');
        const counterEl = document.getElementById('counter');
        const chime = document.getElementById('chime');

        let eventCount = 0;
        let ws;
        let reconnectTimeout;

        function connect() {
            statusDot.className = 'dot connecting';
            statusText.textContent = 'Connecting...';

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            ws = new WebSocket(`${protocol}//${window.location.host}/ws/events`);

            ws.onopen = () => {
                statusDot.className = 'dot connected';
                statusText.textContent = 'Connected';
            };

            ws.onclose = () => {
                statusDot.className = 'dot';
                statusText.textContent = 'Disconnected - reconnecting...';
                reconnectTimeout = setTimeout(connect, 3000);
            };

            ws.onerror = () => {
                ws.close();
            };

            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    addEvent(data);
                    playChime();
                } catch (e) {
                    console.error('Failed to parse event:', e);
                }
            };
        }

        function addEvent(data) {
            eventCount++;
            counterEl.textContent = eventCount;

            // Remove empty message if present
            const empty = eventsContainer.querySelector('.empty');
            if (empty) empty.remove();

            const eventEl = document.createElement('div');
            eventEl.className = 'event';
            eventEl.innerHTML = `
                <div class="event-header">
                    <span class="event-type">${data.type}</span>
                    <span class="event-time">${new Date(data.timestamp * 1000).toLocaleTimeString()}</span>
                </div>
                <div class="event-hash">${data.hash}</div>
            `;

            eventsContainer.insertBefore(eventEl, eventsContainer.firstChild);

            // Keep only last 50 events
            while (eventsContainer.children.length > 50) {
                eventsContainer.removeChild(eventsContainer.lastChild);
            }
        }

        function playChime() {
            chime.currentTime = 0;
            chime.play().catch(() => {});
        }

        connect();
    </script>
</body>
</html>